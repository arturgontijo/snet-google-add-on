<!DOCTYPE html>

<html lang="en">

  <head>
    <meta charset="utf-8">
    <link href="https://ssl.gstatic.com/docs/script/css/add-ons.css" rel="stylesheet">
  </head>

  <body class="bg-light">

    <style scoped>
        @import url('https://getbootstrap.com/docs/4.4/dist/css/bootstrap.min.css');
    </style>

    <main role="main" class="container">
      <div class="my-3 p-3 bg-white rounded shadow-sm">
        <h6 class="border-bottom border-gray pb-2 mb-0">Period</h6>
        <div class="mb-3 bg-white rounded shadow-sm">
            <input type="number" min=5 class="form-control" id="period" value="5">
        </div>
        <h6 class="border-bottom border-gray pb-2 mb-0">Points (Forecast)</h6>
        <div class="mb-3 bg-white rounded shadow-sm">
            <input type="number" min=1 max=500 class="form-control" id="points" value="30">
        </div>
        <div class="mb-3 bg-white rounded shadow-sm">
            <p><a class="btn btn-primary btn-md btn-block" id="call_service" href="#" role="button">Predict &raquo;</a></p>
        </div>
        <hr class="mb-4">
        <p class="d-block text-center mt-3" id="status"></p>
        <hr class="mb-4">
        <small class="d-block text-left mt-3">
            <a href="https://www.singularitynet.io" target="_blank">User's Guide</a>
        </small>
      </div>
    </main>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script>
        // REQUIRES SSL (HTTPS)
        function load_data(url, payload) {
          document.getElementById("status").innerHTML = "Processing...";
          $.ajax({
              url: url,
              type: 'POST',
              crossDomain: true,
              dataType : "json",
              contentType: "application/json",
              data: JSON.stringify(payload),
              success: function(response) {
                  document.getElementById("status").innerHTML = "Writing Data...";
                  if (payload["y"] === undefined) { payload["y"] = response.observed }
                  google.script.run.withSuccessHandler(function(ret){
                    document.getElementById("status").innerHTML = "Done!";
                    document.getElementById("call_service").classList.remove('disabled');
                  }).WriteColumns(payload["y"], response);
                  return response;
              },
              error: function(error){
                  console.log("Error! " + error);
                  document.getElementById("status").innerHTML = "Fail!";
                  document.getElementById("call_service").classList.remove('disabled');
              }
          });
        };
    
        $('#call_service').click(function() {
            document.getElementById("call_service").classList.add('disabled');
            google.script.run.withSuccessHandler(function(selection){
                if(selection && selection.length === 2){
                    var payload = {
                    "ds": selection[0],
                    "y": selection[1],
                    "period": document.getElementById("period").value,
                    "points": document.getElementById("points").value
                    };
                    var response = load_data('https://bh.singularitynet.io:7089/Forecast/forecast', payload);
                } else {
                    document.getElementById("status").innerHTML = "Select 2 columns.";
                    document.getElementById("call_service").classList.remove('disabled');
                }
            }).getSelection();
            return;  
        });
    
        $('#window_len').keyup(function(e) {
            if (e.keyCode === 13) {
                $('#call_service').click();
            }
        });
      </script>

  </body>

</html>